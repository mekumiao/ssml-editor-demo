"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("vue"),s=require("@wangeditor/editor");var O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ce(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var me="Expected a function",z=0/0,Ne="[object Symbol]",Ie=/^\s+|\s+$/g,Me=/^[-+]0x[0-9a-f]+$/i,Le=/^0b[01]+$/i,Oe=/^0o[0-7]+$/i,Ve=parseInt,Ae=typeof O=="object"&&O&&O.Object===Object&&O,Pe=typeof self=="object"&&self&&self.Object===Object&&self,Fe=Ae||Pe||Function("return this")(),Be=Object.prototype,_e=Be.toString,je=Math.max,He=Math.min,B=function(){return Fe.Date.now()};function Re(t,e,n){var r,o,i,a,c,u,d=0,f=!1,m=!1,p=!0;if(typeof t!="function")throw new TypeError(me);e=G(e)||0,A(n)&&(f=!!n.leading,m="maxWait"in n,i=m?je(G(n.maxWait)||0,e):i,p="trailing"in n?!!n.trailing:p);function g(b){var k=r,L=o;return r=o=void 0,d=b,a=t.apply(L,k),a}function y(b){return d=b,c=setTimeout(x,e),f?g(b):a}function E(b){var k=b-u,L=b-d,W=e-k;return m?He(W,i-L):W}function w(b){var k=b-u,L=b-d;return u===void 0||k>=e||k<0||m&&L>=i}function x(){var b=B();if(w(b))return I(b);c=setTimeout(x,E(b))}function I(b){return c=void 0,p&&r?g(b):(r=o=void 0,a)}function M(){c!==void 0&&clearTimeout(c),d=0,r=u=o=c=void 0}function De(){return c===void 0?a:I(B())}function F(){var b=B(),k=w(b);if(r=arguments,o=this,u=b,k){if(c===void 0)return y(u);if(m)return c=setTimeout(x,e),g(u)}return c===void 0&&(c=setTimeout(x,e)),a}return F.cancel=M,F.flush=De,F}function Ue(t,e,n){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(me);return A(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Re(t,e,{leading:r,maxWait:e,trailing:o})}function A(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function qe(t){return!!t&&typeof t=="object"}function We(t){return typeof t=="symbol"||qe(t)&&_e.call(t)==Ne}function G(t){if(typeof t=="number")return t;if(We(t))return z;if(A(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=A(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Ie,"");var n=Le.test(t);return n||Oe.test(t)?Ve(t.slice(2),n?2:8):Me.test(t)?z:+t}var ze=Ue;const D=Ce(ze);let Ge=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function C(t="r"){return`${t}-${Ge()}`}function $(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function R(t,e){t===void 0&&(t={}),e===void 0&&(e={}),Object.keys(e).forEach(function(n){typeof t[n]>"u"?t[n]=e[n]:$(e[n])&&$(t[n])&&Object.keys(e[n]).length>0&&R(t[n],e[n])})}var pe={body:{},addEventListener:function(){},removeEventListener:function(){},activeElement:{blur:function(){},nodeName:""},querySelector:function(){return null},querySelectorAll:function(){return[]},getElementById:function(){return null},createEvent:function(){return{initEvent:function(){}}},createElement:function(){return{children:[],childNodes:[],style:{},setAttribute:function(){},getElementsByTagName:function(){return[]}}},createElementNS:function(){return{}},importNode:function(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function U(){var t=typeof document<"u"?document:{};return R(t,pe),t}var $e={document:pe,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState:function(){},pushState:function(){},go:function(){},back:function(){}},CustomEvent:function(){return this},addEventListener:function(){},removeEventListener:function(){},getComputedStyle:function(){return{getPropertyValue:function(){return""}}},Image:function(){},Date:function(){},screen:{},setTimeout:function(){},clearTimeout:function(){},matchMedia:function(){return{}},requestAnimationFrame:function(t){return typeof setTimeout>"u"?(t(),null):setTimeout(t,0)},cancelAnimationFrame:function(t){typeof setTimeout>"u"||clearTimeout(t)}};function ve(){var t=typeof window<"u"?window:{};return R(t,$e),t}function Xe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},j(t)}function P(t,e){return P=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},P(t,e)}function Ze(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function V(t,e,n){return Ze()?V=Reflect.construct:V=function(o,i,a){var c=[null];c.push.apply(c,i);var u=Function.bind.apply(o,c),d=new u;return a&&P(d,a.prototype),d},V.apply(null,arguments)}function Je(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function H(t){var e=typeof Map=="function"?new Map:void 0;return H=function(r){if(r===null||!Je(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return V(r,arguments,j(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),P(o,r)},H(t)}function Qe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ye(t){var e=t.__proto__;Object.defineProperty(t,"__proto__",{get:function(){return e},set:function(r){e.__proto__=r}})}var N=function(t){Xe(e,t);function e(n){var r;return r=t.call.apply(t,[this].concat(n))||this,Ye(Qe(r)),r}return e}(H(Array));function q(t){t===void 0&&(t=[]);var e=[];return t.forEach(function(n){Array.isArray(n)?e.push.apply(e,q(n)):e.push(n)}),e}function Ke(t){for(var e=[],n=0;n<t.length;n+=1)e.indexOf(t[n])===-1&&e.push(t[n]);return e}function et(t){return t.toLowerCase().replace(/-(.)/g,function(e,n){return n.toUpperCase()})}function tt(t,e){if(typeof t!="string")return[t];for(var n=[],r=e.querySelectorAll(t),o=0;o<r.length;o+=1)n.push(r[o]);return n}function h(t,e){var n=ve(),r=U(),o=[];if(!e&&t instanceof N)return t;if(!t)return new N(o);if(typeof t=="string"){var i=t.trim();if(i.indexOf("<")>=0&&i.indexOf(">")>=0){var a="div";i.indexOf("<li")===0&&(a="ul"),i.indexOf("<tr")===0&&(a="tbody"),(i.indexOf("<td")===0||i.indexOf("<th")===0)&&(a="tr"),i.indexOf("<tbody")===0&&(a="table"),i.indexOf("<option")===0&&(a="select");var c=r.createElement(a);c.innerHTML=i;for(var u=0;u<c.childNodes.length;u+=1)o.push(c.childNodes[u])}else o=tt(t.trim(),e||r)}else if(t.nodeType||t===n||t===r)o.push(t);else if(Array.isArray(t)){if(t instanceof N)return t;o=t}return new N(Ke(o))}h.fn=N.prototype;function X(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=q(e.map(function(o){return o.split(" ")}));return this.forEach(function(o){var i;(i=o.classList).add.apply(i,r)}),this}function Z(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=q(e.map(function(o){return o.split(" ")}));return this.forEach(function(o){var i;(i=o.classList).remove.apply(i,r)}),this}function J(t,e){if(arguments.length===1&&typeof t=="string")return this[0]?this[0].getAttribute(t):void 0;for(var n=0;n<this.length;n+=1)if(arguments.length===2)this[n].setAttribute(t,e);else for(var r in t)this[n][r]=t[r],this[n].setAttribute(r,t[r]);return this}function Q(){var t=this[0];if(t){var e={};if(t.dataset)for(var n in t.dataset)e[n]=t.dataset[n];else for(var r=0;r<t.attributes.length;r+=1){var o=t.attributes[r];o.name.indexOf("data-")>=0&&(e[et(o.name.split("data-")[1])]=o.value)}for(var i in e)e[i]==="false"?e[i]=!1:e[i]==="true"?e[i]=!0:parseFloat(e[i])===e[i]*1&&(e[i]*=1);return e}}function Y(t){if(typeof t>"u"){var e=this[0];if(!e)return;if(e.multiple&&e.nodeName.toLowerCase()==="select"){for(var n=[],r=0;r<e.selectedOptions.length;r+=1)n.push(e.selectedOptions[r].value);return n}return e.value}for(var o=0;o<this.length;o+=1){var i=this[o];if(Array.isArray(t)&&i.multiple&&i.nodeName.toLowerCase()==="select")for(var a=0;a<i.options.length;a+=1)i.options[a].selected=t.indexOf(i.options[a].value)>=0;else i.value=t}return this}function K(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0],o=e[1],i=e[2],a=e[3];typeof e[1]=="function"&&(r=e[0],i=e[1],a=e[2],o=void 0),a||(a=!1);function c(E){var w=E.target;if(w){var x=E.target.dom7EventData||[];if(x.indexOf(E)<0&&x.unshift(E),h(w).is(o))i.apply(w,x);else for(var I=h(w).parents(),M=0;M<I.length;M+=1)h(I[M]).is(o)&&i.apply(I[M],x)}}function u(E){var w=E&&E.target?E.target.dom7EventData||[]:[];w.indexOf(E)<0&&w.unshift(E),i.apply(this,w)}for(var d=r.split(" "),f,m=0;m<this.length;m+=1){var p=this[m];if(o)for(f=0;f<d.length;f+=1){var y=d[f];p.dom7LiveListeners||(p.dom7LiveListeners={}),p.dom7LiveListeners[y]||(p.dom7LiveListeners[y]=[]),p.dom7LiveListeners[y].push({listener:i,proxyListener:c}),p.addEventListener(y,c,a)}else for(f=0;f<d.length;f+=1){var g=d[f];p.dom7Listeners||(p.dom7Listeners={}),p.dom7Listeners[g]||(p.dom7Listeners[g]=[]),p.dom7Listeners[g].push({listener:i,proxyListener:u}),p.addEventListener(g,u,a)}}return this}function ee(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0],o=e[1],i=e[2],a=e[3];typeof e[1]=="function"&&(r=e[0],i=e[1],a=e[2],o=void 0),a||(a=!1);for(var c=r.split(" "),u=0;u<c.length;u+=1)for(var d=c[u],f=0;f<this.length;f+=1){var m=this[f],p=void 0;if(!o&&m.dom7Listeners?p=m.dom7Listeners[d]:o&&m.dom7LiveListeners&&(p=m.dom7LiveListeners[d]),p&&p.length)for(var g=p.length-1;g>=0;g-=1){var y=p[g];i&&y.listener===i||i&&y.listener&&y.listener.dom7proxy&&y.listener.dom7proxy===i?(m.removeEventListener(d,y.proxyListener,a),p.splice(g,1)):i||(m.removeEventListener(d,y.proxyListener,a),p.splice(g,1))}}return this}function te(){for(var t=0;t<this.length;t+=1)this[t].style.display="none";return this}function ne(t){return t?(this.forEach(function(e,n){t.apply(e,[e,n])}),this):this}function re(t){if(typeof t>"u")return this[0]?this[0].innerHTML:null;for(var e=0;e<this.length;e+=1)this[e].innerHTML=t;return this}function oe(t){var e=ve(),n=U(),r=this[0],o,i;if(!r||typeof t>"u")return!1;if(typeof t=="string"){if(r.matches)return r.matches(t);if(r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(r.msMatchesSelector)return r.msMatchesSelector(t);for(o=h(t),i=0;i<o.length;i+=1)if(o[i]===r)return!0;return!1}if(t===n)return r===n;if(t===e)return r===e;if(t.nodeType||t instanceof N){for(o=t.nodeType?[t]:t,i=0;i<o.length;i+=1)if(o[i]===r)return!0;return!1}return!1}function ie(){for(var t,e=U(),n=0;n<arguments.length;n+=1){t=n<0||arguments.length<=n?void 0:arguments[n];for(var r=0;r<this.length;r+=1)if(typeof t=="string"){var o=e.createElement("div");for(o.innerHTML=t;o.firstChild;)this[r].appendChild(o.firstChild)}else if(t instanceof N)for(var i=0;i<t.length;i+=1)this[r].appendChild(t[i]);else this[r].appendChild(t)}return this}function se(t){for(var e=[],n=0;n<this.length;n+=1)for(var r=this[n].parentNode;r;)t?h(r).is(t)&&e.push(r):e.push(r),r=r.parentNode;return h(e)}function ae(t){for(var e=[],n=0;n<this.length;n+=1)for(var r=this[n].querySelectorAll(t),o=0;o<r.length;o+=1)e.push(r[o]);return h(e)}function le(t){for(var e=[],n=0;n<this.length;n+=1)for(var r=this[n].children,o=0;o<r.length;o+=1)(!t||h(r[o]).is(t))&&e.push(r[o]);return h(e)}var nt="resize scroll".split(" ");function he(t){function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(typeof r[0]>"u"){for(var i=0;i<this.length;i+=1)nt.indexOf(t)<0&&(t in this[i]?this[i][t]():h(this[i]).trigger(t));return this}return this.on.apply(this,[t].concat(r))}return e}var ue=he("click"),fe=he("focus");te&&(h.fn.hide=te);ie&&(h.fn.append=ie);ue&&(h.fn.click=ue);K&&(h.fn.on=K);ee&&(h.fn.off=ee);fe&&(h.fn.focus=fe);J&&(h.fn.attr=J);Y&&(h.fn.val=Y);re&&(h.fn.html=re);Q&&(h.fn.dataset=Q);X&&(h.fn.addClass=X);Z&&(h.fn.removeClass=Z);le&&(h.fn.children=le);ne&&(h.fn.each=ne);ae&&(h.fn.find=ae);oe&&(h.fn.is=oe);se&&(h.fn.parents=se);const rt={class:"button"},ot={class:"content"},it=l.defineComponent({__name:"EditBarButton",props:{text:{},icon:{},disabled:{type:Boolean,default:!1}},emits:["click","update:visiblePopover"],setup(t,{emit:e}){const n=t,r=l.inject("editor"),o=()=>{!n.disabled&&r&&e("click",r==null?void 0:r.value)};return(i,a)=>(l.openBlock(),l.createElementBlock("div",{class:l.normalizeClass(["btn edit-bar-button",{disabled:i.disabled}]),onClick:o,onMousedown:a[0]||(a[0]=l.withModifiers(()=>{},["prevent"]))},[l.createElementVNode("div",rt,[l.createElementVNode("span",{class:l.normalizeClass(["size font-size-3 iconfont-moyin",[`moyin-icon_${i.icon}`]])},null,2)]),l.createElementVNode("div",ot,l.toDisplayString(i.text),1)],34))}});const st=(t,e)=>{const n=t.__vccOpts||t;for(const[r,o]of e)n[r]=o;return n},T=st(it,[["__scopeId","data-v-8c22fc50"]]);function at(){return C("w-e-insert-speaker")}let lt=class{getValue(e){const{selection:n}=e;return n==null?null:s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;if(n==null||s.SlateRange.isCollapsed(n))return!0;const r=s.SlateEditor.string(e,n);return r.length!=1||!/^[\u4E00-\u9FA5]+$/gi.test(r)}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-p",domId:at(),word:o,phoneme:n,remark:n,bgColor:"speaker",children:[{text:""}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i),e.move(1);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault();const[f]=s.SlateEditor.nodes(e,{at:[],match:p=>!s.SlateElement.isElement(p)||!s.DomEditor.checkNodeType(p,"ssml-p")?!1:p.domId===i.domId});if(f==null)return;const m=s.SlateEditor.previous(e,{at:f[1],match:p=>s.SlateText.isText(p)});m!=null&&(s.SlateTransforms.insertText(e,f[0].word,{at:s.SlateEditor.end(e,m[1])}),s.SlateTransforms.delete(e,{at:s.SlatePath.next(m[1])}))});a.on("click",c,u)}};function ut(t){const e={我:[{id:"1",text:"wo1",remark:"wo1"},{id:"2",text:"wo2",remark:"wo2"},{id:"3",text:"wo3",remark:"wo3"}],的:[{id:"1",text:"de1",remark:"de1"},{id:"2",text:"de2",remark:"de2"},{id:"3",text:"de3",remark:"de3"}]};return Promise.resolve(e[t]||e.我)}const ge=l.defineComponent({emits:["error"],props:["popover","fetch"],setup(t,{emit:e}){const n=new lt,r=l.inject("editor"),o=l.ref([]),i=l.ref(!1);function a(){i.value||(i.value=!0)}function c(){i.value&&(i.value=!1)}async function u(f){const m=n.getValue(f);if(m?o.value=await(t.fetch||ut)(m):o.value=[],n.isDisabled(f))return e("error","选中一个中文字符，并且有不能在其他语句之内");if(o.value.length==0)return e("error","选中的字符没有不是多音字");a()}const d=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(d,{visible:i.value,"onUpdate:visible":f=>i.value=f,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"多音字",icon:"speaker",onClick:u},null),default:()=>l.createVNode("div",{class:"flex flex-col"},[o.value.map(({id:f,text:m})=>l.createVNode("div",{key:f,class:"btn full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,m),c()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[m]))])})}});function ft(){return C("w-e-insert-continuous")}class ct{getValue(e){const{selection:n}=e;return n==null?"":s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;return!!(n==null||s.SlateRange.isCollapsed(n)||s.SlateEditor.string(e,n).length<2)}exec(e){if(this.isDisabled(e))return;const{selection:n}=e;if(n==null)return;const r=this.getValue(e);if(r==null)return;const o={type:"ssml-w",domId:ft(),children:[{text:r}],remark:"连读",bgColor:"continuous"};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,o);const i=h("body"),a=`#${o.domId}`,c=D(u=>{u.preventDefault(),s.SlateTransforms.unwrapNodes(e,{at:[],match:d=>!s.SlateElement.isElement(d)||!s.DomEditor.checkNodeType(d,"ssml-w")?!1:d.domId===o.domId})});i.on("click",a,c)}}const ye=l.defineComponent({emits:["error"],setup(t,{emit:e}){const n=new ct;function r(o){if(n.isDisabled(o))return e("error","请选择多个中文字符或者多个多个英文单词");n.exec(o)}return()=>l.createVNode(T,{text:"连读",icon:"continuous",onClick:r},null)}});function dt(){return C("w-e-insert-read")}class mt{getValue(e){const{selection:n}=e;return n==null?"":s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;return!!(n==null||s.SlateRange.isCollapsed(n)||s.SlateEditor.string(e,n).length<=0)}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-w",domId:dt(),phoneme:n.id,remark:n.remark,value:o,bgColor:"read",children:[{text:o}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault();const[f]=s.SlateEditor.nodes(e,{at:[],match:p=>!s.SlateElement.isElement(p)||!s.DomEditor.checkNodeType(p,"ssml-w")?!1:p.domId===i.domId,universal:!1});if(f==null)return;const m=s.SlateEditor.previous(e,{at:f[1],match:p=>s.SlateText.isText(p)});m!=null&&(s.SlateTransforms.insertText(e,o,{at:s.SlateEditor.end(e,m[1])}),s.SlateTransforms.delete(e,{at:s.SlatePath.next(m[1])}))});a.on("click",c,u)}}const pt=[{id:"z",text:"重音",remark:"重"},{id:"t",text:"拖音",remark:"拖"},{id:"all",text:"重音+拖音",remark:"重+拖"}],be=l.defineComponent({emits:["error"],props:["popover"],setup(t,{emit:e}){const n=new mt,r=l.inject("editor"),o=l.ref(!1);function i(){o.value||(o.value=!0)}function a(){o.value&&(o.value=!1)}function c(d){if(n.isDisabled(d)){e("error","请先选择文本");return}i()}const u=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(u,{visible:o.value,"onUpdate:visible":d=>o.value=d,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"重音",icon:"read",onClick:c},null),default:()=>l.createVNode("div",{class:"flex flex-col",onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[pt.map(({id:d,text:f,remark:m})=>l.createVNode("div",{key:d,class:"btn full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,{id:d,text:f,remark:m}),a()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[f]))])})}});function vt(){return C("w-e-insert-digital")}class ht{getValue(e){const{selection:n}=e;return n==null?"":s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;if(n==null||s.SlateRange.isCollapsed(n))return!0;const r=s.SlateEditor.string(e,n);return!!(r.length<=0||Number.isNaN(Number(r)))}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-say-as",domId:vt(),interpretAs:n.id,remark:n.remark,bgColor:"digital",children:[{text:o}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault(),s.SlateTransforms.unwrapNodes(e,{at:[],match:f=>!s.SlateElement.isElement(f)||!s.DomEditor.checkNodeType(f,"ssml-say-as")?!1:f.domId===i.domId})});a.on("click",c,u)}}const gt=[{id:"value",text:"读数值",remark:"读数值"},{id:"digits",text:"读数字",remark:"读数字"},{id:"telephone",text:"读手机号",remark:"读手机号"}],Se=l.defineComponent({emits:["error"],props:["popover"],setup(t,{emit:e}){const n=new ht,r=l.inject("editor"),o=l.ref(!1);function i(){o.value=!o.value}function a(u){if(n.isDisabled(u)){e("error","请选择纯数字文本");return}i()}const c=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(c,{visible:o.value,"onUpdate:visible":u=>o.value=u,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"数字符号",icon:"digital",onClick:a},null),default:()=>l.createVNode("div",{class:"flex flex-col"},[gt.map(({id:u,text:d,remark:f})=>l.createVNode("div",{key:u,class:"btn radius ssml-menu item full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,{id:u,text:d,remark:f}),i()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[d]))])})}});function yt(){return C("w-e-insert-alias")}class bt{getValue(e){const{selection:n}=e;return n==null?null:s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;return!!(n==null||s.SlateRange.isCollapsed(n)||s.SlateEditor.string(e,n).length<=0)}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-sub",domId:yt(),remark:`[${n}]`,alias:n,value:o,bgColor:"alias",children:[{text:""}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault();const[f]=s.SlateEditor.nodes(e,{at:[],match:p=>!s.SlateElement.isElement(p)||!s.DomEditor.checkNodeType(p,"ssml-sub")?!1:p.domId===i.domId});if(f==null)return;const m=s.SlateEditor.previous(e,{at:f[1],match:p=>s.SlateText.isText(p)});m!=null&&(s.SlateTransforms.insertText(e,f[0].value,{at:s.SlateEditor.end(e,m[1])}),s.SlateTransforms.delete(e,{at:s.SlatePath.next(m[1])}))});a.on("click",c,u)}}const Ee=l.defineComponent({emits:["error"],props:["popover","input"],setup(t,{emit:e}){const n=new bt,r=l.inject("editor"),o=l.ref(),i=l.ref(!1),a=l.shallowRef();function c(){i.value||(i.value=!0)}function u(){i.value&&(i.value=!1)}async function d(g){if(n.isDisabled(g)){e("error","选中一个中文字符，并且有不能在其他语句之内");return}c(),a.value=g.selection,o.value.focus()}const f=g=>{u();const y=r==null?void 0:r.value;!y||!g||(y.select(a.value),!n.isDisabled(y)&&n.exec(y,g))},m=l.resolveDynamicComponent(t.popover),p=l.resolveDynamicComponent(t.input);return()=>l.createVNode(m,{visible:i.value,"onUpdate:visible":g=>i.value=g,trigger:"contextmenu",placement:"right-end",hideAfter:0,width:200},{reference:()=>l.createVNode(T,{text:"别名",icon:"alias",onClick:d},null),default:()=>l.createVNode(p,{ref:o,onSubmit:f},null)})}});function St(t){const{selection:e}=t;if(e){const[n,r]=s.SlateRange.edges(e),o=s.SlateEditor.range(t,n,r),i=s.SlateEditor.string(t,o),a=i.trimEnd();if(a!==i){const c=i.length-a.length,u={...r,offset:r.offset-c},d={...e,anchor:n,focus:u};s.SlateTransforms.select(t,d)}}}function Et(){return C("w-e-insert-english")}class wt{getValue(e){const{selection:n}=e;return n==null?null:s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;if(n==null||s.SlateRange.isCollapsed(n))return!0;const r=s.SlateEditor.string(e,n);return r.length<=0||!/^[A-Za-z]+$/gi.test(r)}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-p",domId:Et(),word:o,phoneme:n,remark:n,bgColor:"english",children:[{text:""}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i),e.move(1);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault();const[f]=s.SlateEditor.nodes(e,{at:[],match:p=>!s.SlateElement.isElement(p)||!s.DomEditor.checkNodeType(p,"ssml-p")?!1:p.domId===i.domId});if(f==null)return;const m=s.SlateEditor.previous(e,{at:f[1],match:p=>s.SlateText.isText(p)});m!=null&&(s.SlateTransforms.insertText(e,f[0].word,{at:s.SlateEditor.end(e,m[1])}),s.SlateTransforms.delete(e,{at:s.SlatePath.next(m[1])}))});a.on("click",c,u)}}function xt(t){const e={translate:[{id:"1",text:"wərd",remark:"wərd"}],global:[{id:"2",text:"ˈɡlōbəl",remark:"ˈɡlōbəl"}]};return Promise.resolve(e[t]||e.translate)}const we=l.defineComponent({emits:["error"],props:["popover","fetch"],setup(t,{emit:e}){const n=new wt,r=l.inject("editor"),o=l.ref([]),i=l.ref(!1);function a(){i.value||(i.value=!0)}function c(){i.value&&(i.value=!1)}async function u(f){if(St(f),n.isDisabled(f))return e("error","请选择英文单词");const m=n.getValue(f);if(m){if(o.value=await(t.fetch||xt)(m),o.value.length<=0)return e("error","找不到单词的音标");a()}}const d=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(d,{visible:i.value,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"音标",icon:"english",onClick:u},null),default:()=>l.createVNode("div",{class:"flex flex-col"},[o.value.map(({id:f,text:m})=>l.createVNode("div",{key:f,class:"btn full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,m),c()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[m]))])})}});function Tt(){return C("w-e-insert-changespeed")}class kt{getValue(e){const{selection:n}=e;return n==null?null:s.SlateEditor.string(e,n)}isDisabled(e){const{selection:n}=e;return!!(n==null||s.SlateRange.isCollapsed(n)||s.SlateEditor.string(e,n).length<=1)}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o=this.getValue(e);if(o==null)return;const i={type:"ssml-prosody",domId:Tt(),remark:n,rate:n,bgColor:"changespeed",children:[{text:o}]};s.SlateTransforms.delete(e),s.SlateTransforms.insertNodes(e,i);const a=h("body"),c=`#${i.domId}`,u=D(d=>{d.preventDefault(),s.SlateTransforms.unwrapNodes(e,{at:[],match:f=>!s.SlateElement.isElement(f)||!s.DomEditor.checkNodeType(f,"ssml-prosody")?!1:f.domId===i.domId})});a.on("click",c,u)}}function Dt(){const t=[];for(let e=2;e<=40;e++){const n=`${(e*.05).toFixed(2)}x`;t.push({id:e.toString(),text:n,remark:n})}return Promise.resolve(t)}const xe=l.defineComponent({emits:["error"],props:["popover"],setup(t,{emit:e}){const n=new kt,r=l.inject("editor"),o=l.ref([]),i=l.ref(!1);function a(){i.value||(i.value=!0)}function c(){i.value&&(i.value=!1)}async function u(f){if(o.value=await Dt(),n.isDisabled(f)){e("error","选中一个中文字符，并且有不能在其他语句之内");return}a()}const d=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(d,{style:{padding:"0px"},visible:i.value,"onUpdate:visible":f=>i.value=f,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"局部变速",icon:"changespeed",onClick:u},null),default:()=>l.createVNode("div",{class:"flex flex-col h h-50 scroll scroll-y"},[o.value.map(({id:f,text:m})=>l.createVNode("div",{key:f,class:"btn full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,m),c()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[m]))])})}});function Ct(){return C("w-e-insert-rhythm")}class Nt{isDisabled(e){const{selection:n}=e;return!!(n==null||s.SlateRange.isExpanded(n))}exec(e,n){if(this.isDisabled(e))return;const{selection:r}=e;if(r==null)return;const o={type:"ssml-break",domId:Ct(),time:n.id,remark:n.remark,bgColor:"rhythm",children:[{text:""}]};s.SlateTransforms.insertNodes(e,o),e.move(1);const i=h("body"),a=`#${o.domId}`,c=D(u=>{u.preventDefault();const[d]=s.SlateEditor.nodes(e,{at:[],match:f=>!s.SlateElement.isElement(f)||!s.DomEditor.checkNodeType(f,"ssml-break")?!1:f.domId===o.domId});d!=null&&s.SlateTransforms.delete(e,{at:d[1]})});i.on("click",a,c)}}const It=[{id:"200ms",text:"短",remark:"短"},{id:"300ms",text:"中",remark:"中"},{id:"500ms",text:"长",remark:"长"}],Te=l.defineComponent({emits:["error"],props:["popover"],setup(t,{emit:e}){const n=new Nt,r=l.inject("editor"),o=l.ref(!1);function i(){o.value||(o.value=!0)}function a(){o.value&&(o.value=!1)}function c(d){if(n.isDisabled(d)){e("error","不能选择文本");return}i()}const u=l.resolveDynamicComponent(t.popover);return()=>l.createVNode(u,{visible:o.value,"onUpdate:visible":d=>o.value=d,trigger:"contextmenu",hideAfter:0},{reference:()=>l.createVNode(T,{text:"停顿调节",icon:"rhythm",onClick:c},null),default:()=>l.createVNode("div",{class:"flex flex-col"},[It.map(({id:d,text:f,remark:m})=>l.createVNode("div",{key:d,class:"btn radius ssml-menu item full",onClick:()=>{n.isDisabled(r==null?void 0:r.value)||n.exec(r==null?void 0:r.value,{id:d,text:f,remark:m}),a()},onMousedown:l.withModifiers(()=>{},["stop","prevent"])},[f]))])})}});function ce(t,e,n,r,o){const i=e===void 0?void 0:e.key;return{sel:t,data:e,children:n,text:r,elm:o,key:i}}const de=Array.isArray;function _(t){return typeof t=="string"||typeof t=="number"||t instanceof String||t instanceof Number}function ke(t,e,n){if(t.ns="http://www.w3.org/2000/svg",n!=="foreignObject"&&e!==void 0)for(let r=0;r<e.length;++r){const o=e[r];if(typeof o=="string")continue;const i=o.data;i!==void 0&&ke(i,o.children,o.sel)}}function v(t,e,n){let r={},o,i,a;if(n!==void 0?(e!==null&&(r=e),de(n)?o=n:_(n)?i=n.toString():n&&n.sel&&(o=[n])):e!=null&&(de(e)?o=e:_(e)?i=e.toString():e&&e.sel?o=[e]:r=e),o!==void 0)for(a=0;a<o.length;++a)_(o[a])&&(o[a]=ce(void 0,void 0,void 0,o[a],void 0));return t[0]==="s"&&t[1]==="v"&&t[2]==="g"&&(t.length===3||t[3]==="."||t[3]==="#")&&ke(r,o,t),ce(t,r,o,i,void 0)}const S={style:{userSelect:"none"},contentEditable:!1};function Mt(t){const{domId:e,bgColor:n,remark:r,word:o}=t;return v("span.ssml-wrap",{...S},[v(`span.tag.bg-color.${n}`,[v("span.tag-remark",{attrs:{"data-tag-remark":r}}),v(`span#${e}.btn.btn-text`,v("span.iconfont.icon-roundclosefill",null))]),v(`span.boundary.start.ft-color.${n}`),v("span",o),v(`span.boundary.end.ft-color.${n}`)])}function Lt(t,e){const{bgColor:n,domId:r,remark:o,value:i}=t;return v("span.ssml-wrap",e?{}:{...S},[v(`span.tag.bg-color.${n}`,{...S},[v("span.tag-remark",{attrs:{"data-tag-remark":o}}),v(`span#${r}.btn.btn-text`,v("span.iconfont.icon-roundclosefill",null))]),v(`span.boundary.start.ft-color.${n}`,{...S}),v("span",e||i),v(`span.boundary.end.ft-color.${n}`,{...S})])}function Ot(t,e){const{bgColor:n,domId:r,remark:o}=t;return v("span.ssml-wrap",[v(`span.tag.bg-color.${n}`,{...S},[v("span.tag-remark",{attrs:{"data-tag-remark":o}}),v(`span#${r}.btn.btn-text`,v("span.iconfont.icon-roundclosefill",null))]),v(`span.boundary.start.ft-color.${n}`,{...S}),v("span",e),v(`span.boundary.end.ft-color.${n}`,{...S})])}function Vt(t){const{domId:e,remark:n,bgColor:r}=t;return v("span.ssml-wrap",[v(`span.tag.bg-color.${r}`,{...S},[v("span.tag-remark",{attrs:{"data-tag-remark":n}}),v(`span#${e}.btn.btn-text`,v("span.iconfont.icon-roundclosefill",null))])])}function At(t){const{domId:e,remark:n,bgColor:r,value:o}=t;return v("span.ssml-wrap",{...S},[v(`span.tag.bg-color.${r}`,[v("span.tag-remark",{attrs:{"data-tag-remark":n}}),v(`span#${e}.btn.btn-text`,v("span.iconfont.icon-roundclosefill"))]),v(`span.boundary.start.ft-color.${r}`),v("span",o),v(`span.boundary.end.ft-color.${r}`)])}function Pt(t,e){const{bgColor:n,domId:r,remark:o}=t;return v("span.ssml-wrap",[v(`span.tag.bg-color.${n}`,{...S},[v("span.tag-remark",{attrs:{"data-tag-remark":o}}),v(`span#${r}.btn.btn-text`,v("span.iconfont.icon-roundclosefill",null))]),v(`span.boundary.start.ft-color.${n}`,{...S}),v("span",e),v(`span.boundary.end.ft-color.${n}`,{...S})])}const Ft=[{type:"ssml-p",renderElem:Mt},{type:"ssml-w",renderElem:Lt},{type:"ssml-say-as",renderElem:Ot},{type:"ssml-break",renderElem:Vt},{type:"ssml-sub",renderElem:At},{type:"ssml-prosody",renderElem:Pt}];function Bt(t,e){return`<s>${e}</s>`}function _t(t,e){const{phoneme:n,value:r}=t;return n?`<w phoneme="${n}">${r}</w>`:`<w>${e}</w>`}function jt(t,e){const{word:n,phoneme:r}=t;return`<p ph="${r}">${n}</p>`}function Ht(t,e){const{interpretAs:n}=t;return`<say-as interpret-as="${n}">${e}</say-as>`}function Rt(t,e){const{time:n}=t;return`<break time="${n}" />`}function Ut(t,e){const{alias:n,value:r}=t;return`<sub alias="${n}">${r}</sub>`}function qt(t,e){const{rate:n}=t;return`<prosody rate="${n}">${e}</prosody>`}const Wt=[{type:"paragraph",elemToHtml:Bt},{type:"ssml-w",elemToHtml:_t},{type:"ssml-p",elemToHtml:jt},{type:"ssml-say-as",elemToHtml:Ht},{type:"ssml-break",elemToHtml:Rt},{type:"ssml-sub",elemToHtml:Ut},{type:"ssml-prosody",elemToHtml:qt}];function zt(t){const{isInline:e,isVoid:n,deleteBackward:r,deleteForward:o,insertBreak:i}=t,a=t;return a.isInline=c=>{const u=s.DomEditor.getNodeType(c);return u==="ssml-w"||u==="ssml-p"||u==="ssml-break"||u==="ssml-say-as"||u==="ssml-sub"||u==="ssml-prosody"?!0:e(c)},a.isVoid=c=>{const u=s.DomEditor.getNodeType(c);if(u==="ssml-w"){const{phoneme:d}=c;return!!d}return u==="ssml-p"||u==="ssml-break"?!0:u==="ssml-say-as"?!1:u==="ssml-sub"?!0:u==="ssml-prosody"?!1:n(c)},a.deleteBackward=c=>{r(c)},a.deleteForward=c=>{o(c)},a.insertBreak=()=>{i()},a}const Gt={editorPlugin:zt,renderElems:Ft,elemsToHtml:Wt};const $t={install:t=>{t.component("EditBarButton",T),t.component("SpeakerMenu",ge),t.component("ContinuousMenu",ye),t.component("ReadMenu",be),t.component("DigitalMenu",Se),t.component("AliasMenu",Ee),t.component("EnglishMenu",we),t.component("ChangespeedMenu",xe),t.component("RhythmMenu",Te)}};exports.AliasMenu=Ee;exports.ChangespeedMenu=xe;exports.ContinuousMenu=ye;exports.DigitalMenu=Se;exports.EditorMenuPlugin=$t;exports.EnglishMenu=we;exports.ReadMenu=be;exports.RhythmMenu=Te;exports.SSMLModule=Gt;exports.SpeakerMenu=ge;
